{% extends 'admin1/base1.html' %}
{% load static %} 
{% block content %}
    <div class="main-wrapper">
    
        <!-- Header -->
        {% include 'admin1/include/header.html' %}
                <!-- /Header -->
        
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <a href="index.html">
                        <img src="{% static 'admin/assets/img/logo.svg' %}" class="img-fluid logo" alt="">
                    </a>
                    <a href="index.html">
                        <img src="{% static 'admin/assets/img/logo-small.svg' %}" class="img-fluid logo-small" alt="">
                    </a>
                </div>
                <div class="siderbar-toggle">
                    <label class="switch" id="toggle_btn">
                        <input type="checkbox">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>
            
           {% include 'admin1/include/sidebar.html' %}
        </div>
        <!-- /Sidebar -->
        
        <div class="page-wrapper">
            <div class="content">
				<div class="content-page-header content-page-headersplit">
                    <h5>Edit Ads</h5>
                </div>
                <div class="row">
					<form action='{% url 'edit_ads' id %}' method='POST'>
						{% csrf_token %}
						<div class="col-lg-12 m-auto">
							<!-- Service Information -->
							<fieldset id="first-field">
								<div class="row">
									<div class="col-md-12">
										<div class="sub-title">
											<h6>Ads Name</h6>
										</div> 				
										<div class="form-group">
											<input type="text" class="form-control" value="{{product.product_name}}" placeholder="Product Name" name='product_name'>
										</div>
									</div> 	
									<div class="col-md-6">
										<div class="form-group" name="category">
											<label>Category</label>
											<select class="select" name='category'>
												<option>Select Category</option>
												{% for category in category %}
													<option value="{{category.id}}"
														{% if category.id == product.category.id %}selected{% endif %}>
														{{category.category_name}}
													</option>
												{% endfor %}
											</select>
										</div>
										
									</div> 	
									<div class="col-md-6">
										<div class="form-group">
											<label> Select Sub Category</label>
											<select class="select" name='subcategory'>
												<option>Select Sub Category</option>
												{% for subcategory in category %}
												<option value="{{subcategory.id}}"
												{% if subcategory.id == product.subcategory.id %}selected{% endif %}>{{subcategory.category_name}}</option>
												{% endfor %}
											</select>
										</div>
									</div>	
										
									<div class="col-md-12">
										<div class="form-group">
											<label>Description</label>
											<div id="editor" name='description'>{{product.description}}</div>
											<input type="hidden" name="description" id="descriptionInput">
										</div>
									</div>	
								</div> 
								<div class="row">									
									<div class="col-sm-6">
										<div class="sub-title">
											<h6>Additional Service</h6>
										</div> 										
									</div> 										
								</div> 	
								<div class="addservice-info">
									<div class="row service-cont">
										<div class="col-md-4">
											<div class="form-group">
												<label>Price</label>
												<input type="text" class="form-control" value="{{product.price}}" name='price' placeholder="Enter Price">
											</div>
										</div> 	
										
										<div class="row">									
											<div class="col-md-12">
												<div class="sub-title">
													<h6>Is Negotiations?</h6>
												</div> 										
											</div> 		
											<div class="col-md-12">
												<div class="form-group">
													
													<label class="custom_radio d-inline-block me-3">
														<input type="radio" name="nego" value="on" id="time-slot" {% if product.negotiable %}checked{% endif %}>
														<span class="checkmark"></span> Yes
													</label>
													<label class="custom_radio d-inline-block me-3">
														<input type="radio" name="nego" value="off" id="time-picker"   {% if not product.negotiable %}checked{% endif %} >
														<span class="checkmark"></span> No
													</label>
												</div>
											</div> 	
											
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="field-btns">
											<button class="btn btn-submit next_btn" type="button">Next <i class="fe fe-arrow-right ms-1"></i></button>
										</div>  
									</div>   
								</div>
							</fieldset>
							<!-- /Service Information -->
							
							
							<!-- /Booking -->
							
						
							
								
							<fieldset>
								<div class="sub-title">
									<h6>Cover images</h6>
								</div> 					
								<div class="form-uploads mb-4">
									<div class="form-uploads-path">
										<img src="{% static 'admin/assets/img/icons/upload.svg' %}" alt="img">
										<div class="file-browse">
											<h6>Drag & drop image or </h6>
											<div class="file-browse-path">
												<input type="file" id="imageUpload" accept="image/*" name='cover_images'>
												<a href="javascript:void(0);"> Browse</a>
											</div>
										</div>
										<h5>Supported formats: JPEG, PNG</h5>
							
									</div>
								</div>

								<div class="sub-title">
									<h6>Gallery</h6>
								</div> 					
								<div class="form-uploads mb-4">
									<div class="form-uploads-path">
										<img src="{% static 'admin/assets/img/icons/upload.svg' %}" alt="img">
										<div class="file-browse">
											<h6>Drag & drop image or </h6>
											<div class="file-browse-path">
												<input type="file" id="imageUpload" accept="image/*" name='images' multiple>
												<a href="javascript:void(0);"> Browse</a>
											</div>
										</div>
										<h5>Supported formats: JPEG, PNG</h5>
										<p id="uploadMessage">You can upload up to 8 images. Remaining: 8</p>
									</div>
								</div>
								<div class="file-preview" id="imagePreview">
									<ul id="previewList"></ul>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="field-btns" style='display:flex;'>
											<button class="btn btn-submit" type="button" onclick="goBack()">Go Back</button>
											<button class="btn btn-submit next_btn" type="submit">Submit</button>
										</div>  
									</div>   
								</div>
							</fieldset>
							
							
							
							<!-- /Gallery -->							
							
							
							
						</div>
					</form>
                </div>
            </div>
        </div> 
    </div>



	<script>
		document.getElementById('imageUpload').addEventListener('change', function(event) {
			const files = event.target.files;
			const previewContainer = document.getElementById('previewList');
			const maxFiles = 8;
		
			// Get the current number of uploaded images
			const currentUploads = previewContainer.getElementsByTagName('li').length;
		
			// Check if adding the new files would exceed the max limit
			if (currentUploads + files.length > maxFiles) {
				alert(`You can only upload a total of ${maxFiles} images. You have already uploaded ${currentUploads}.`);
				event.target.value = '';  // Clear the file input
				return;
			}
		
			// Update remaining count message
			document.getElementById('uploadMessage').textContent = `You can upload up to ${maxFiles} images. Remaining: ${maxFiles - (currentUploads + files.length)}`;
		
			// Loop through each file and create an image element
			for (let i = 0; i < files.length; i++) {
				const file = files[i];
				const reader = new FileReader();
		
				reader.onload = function(e) {
					// Create a new list item for the uploaded image
					const li = document.createElement('li');
		
					// Create the image element
					const img = document.createElement('img');
					img.src = e.target.result;
		
					// Create the delete button
					const deleteBtn = document.createElement('button');
					deleteBtn.textContent = 'Ã—';
					deleteBtn.classList.add('delete-btn');
		
					// Add event listener to remove image on click
					deleteBtn.addEventListener('click', function() {
						previewContainer.removeChild(li);
		
						// Update the remaining count message after deletion
						const newUploads = previewContainer.getElementsByTagName('li').length;
						document.getElementById('uploadMessage').textContent = `You can upload up to ${maxFiles} images. Remaining: ${maxFiles - newUploads}`;
					});
		
					// Append the image and delete button to the list item
					li.appendChild(deleteBtn);
					li.appendChild(img);
		
					// Append the new list item to the preview container
					previewContainer.appendChild(li);
				}
		
				reader.readAsDataURL(file);  // Convert the file to a data URL to preview
			}
		});
		
		
		
	</script>

	<script>
		document.querySelector('form').addEventListener('submit', function() {
			// Get the content of the editor div
			var editorContent = document.getElementById('editor').innerHTML;
			
			// Set the content to the hidden input
			document.getElementById('descriptionInput').value = editorContent;
		});
		


	</script>

{% endblock %}