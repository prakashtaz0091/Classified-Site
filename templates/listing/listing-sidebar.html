{% extends 'base.html' %}
{% block content %}
{% load static %}


	<div class="main-wrapper innerpagebg">
	
		<!-- Header -->
		<header class='header'>
		{% include 'includes/header.html' %}
		</header>
		<!-- /Header -->
		
		<!-- Breadscrumb Section -->
		<div class="breadcrumb-bar">
			<div class="container">
				<div class="row align-items-center text-center">
					<div class="col-md-12 col-12">
					   <h2 class="breadcrumb-title">Listings-List</h2>
		    		   <nav aria-label="breadcrumb" class="page-breadcrumb">
						    <ol class="breadcrumb">
							    <li class="breadcrumb-item"><a href="index.html">Home</a></li>
								<li class="breadcrumb-item active" aria-current="page">List</li>
							</ol>
						</nav>							
					</div>
				</div>
			</div>			
		</div>
		<!-- /Breadscrumb Section -->
		
		<!-- Main Content Section -->
		
<div class="list-content">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 theiaStickySidebar">
                <div class="listings-sidebar">
                    <div class="card">
                        <h4><img src="{% static 'assets/img/details-icon.svg' %}" alt="details-icon"> Filter</h4>
                        <form id="filterForm">
                            <div class="filter-content looking-input form-group">
                                <input type="text" id="searchQuery" name="searchQuery" class="form-control" placeholder="What are you looking for?">
                            </div>
                            <div class="filter-content form-group">
                                <select id="categorySelect" name="categorySelect" class="form-control select category-select">
                                    <option value="">Choose Category</option>
                                    <option value="Computer">Computer</option>
                                    <option value="Electronics">Electronics</option>
                                    <option value="Car wash">Car wash</option>
                                </select>
                            </div>
                            <div class="filter-content looking-input form-group input-placeholder">
                                <div class="group-img">
                                    <input type="text" id="locationInput" name="locationInput" class="form-control" placeholder="Where to look?">
                                    <i class="feather-map-pin"></i>
                                </div>
                            </div>
                            <div class="filter-content form-group region">
                                <select id="regionSelect" name="regionSelect" class="form-control select region-select">
                                    <option value="">Region</option>
                                    <option value="Canada">Canada</option>
                                    <option value="USA">USA</option>
                                    <option value="India">India</option>
                                </select>						  
                            </div>
                            <div class="filter-content form-group amenities">
                                <h4>Amenities</h4>
                                <ul>
                                    <li>
                                        <label class="custom_check">
                                            <input type="checkbox" name="amenities" value="wireless-internet">
                                            <span class="checkmark"></span> Wireless Internet
                                        </label>
                                    </li>
                                    <li>
                                        <label class="custom_check">
                                            <input type="checkbox" name="amenities" value="accept-credit-card">
                                            <span class="checkmark"></span> Accepts Credit Cards 
                                        </label>
                                    </li>
                                    <!-- Add more checkboxes as needed -->
                                </ul>
                            </div>
                            <div class="filter-content amenities radius">
                                <div class="slidecontainer">
                                    <div class="slider-info">
                                        <h4>Radius</h4>
                                        <div class="demo"><span>50</span> Radius</div>
                                    </div>
                                    <div class="clearfix"></div>
                                    <div class="filter-range">
                                        <input type="text" id="radiusInput" name="radiusInput" class="input-range">
                                    </div>
                                </div>
                            </div>									
                            <div class="filter-content amenities mb-0">
                                <h4>Price Range</h4>
                                <div class="form-group mb-0">
                                    <input type="text" id="minPrice" name="minPrice" class="form-control" placeholder="Min">
                                    <input type="text" id="maxPrice" name="maxPrice" class="form-control me-0" placeholder="Max">
                                </div>
                                <div class="search-btn">
                                    <button class="btn btn-primary" type="submit"> <i class="fa fa-search" aria-hidden="true"></i> Search</button>
                                    <button class="btn btn-reset mb-0" type="reset"> <i class="fas fa-light fa-arrow-rotate-right"></i> Reset Filters</button>
                                </div>  
                            </div>
                        </form>
                    </div>
                    
                </div>
            </div>
            <div class="col-lg-8">
                <div class="row sorting-div">
                    <div class="col-lg-4 col-sm-4 align-items-center d-flex">
                        <div class="count-search">
                            <p>Showing <span>1-{{count}}</span> of 10 Results</p>
                        </div>
                    </div>
                    <div class="col-lg-8 col-sm-8 align-items-center">
                        <div class="sortbyset">
                            <span class="sortbytitle">Sort by</span>
                            <div class="sorting-select">
                                <select id="sortSelect" class="form-control select" onchange="handleSortChange(this)">
                                    <option value="default">Default</option>
                                    <option value="low-high">Price Low to High</option>
                                    <option value="high-low">Price High to Low</option>
                                </select>
                                
                            </div>
                        </div>
                        <div class="grid-listview">
                            <ul>
                                <li>
                                    <a href="listing-list-sidebar.html" class="active">
                                        <i class="feather-list"></i>
                                    </a>
                                </li>
                                <li>
                                    <a href="listing-grid-sidebar.html">
                                        <i class="feather-grid"></i>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="blog-listview" id='productContainer'>

					{% for product in products %}
                    <div class="card" data-index="{{ forloop.counter }}">
                        <div class="blog-widget">
                            <div class="blog-img">
                                <a href="service-details.html">
                                    <img src="{{product.cover_image.url}}" class="img-fluid" alt="blog-img">
                                </a>
                                <div class="fav-item">
                                    <span class="featured-text">Featured</span>
                                    <a href="javascript:void(0)" class="fav-icon">
                                        <i class="feather-heart"></i>
                                    </a>										
                                </div>															    
                            </div>
                            <div class="bloglist-content">
                                <div class="card-body">
                                     <div class="blogfeaturelink">
                                        <div class="blog-features">
                                           <a href="javascript:void(0);"><span> <i class="fa-regular fa-circle-stop"></i> Construction</span></a>
                                        </div>																	  
                                        <div class="blog-author"> 
                                          <div class="blog-author-img">
                                            <img src="{% static 'assets/img/profiles/avatar-01.jpg' %}" alt="author">
                                          </div>
                                          <a href="javascript:void(0);">John Doe</a>
                                        </div>
                                    </div> 
                                    <h6><a href="service-details.html">{{product.product_name}}</a></h6>																	 
                                    <div class="blog-location-details">
                                        <div class="location-info">
                                           <i class="feather-map-pin"></i> Los Angeles
                                        </div>
                                        <div class="location-info">
                                           <i class="feather-phone-call"></i> +44 6633 6526
                                        </div>
                                        <div class="location-info">
                                           <i class="feather-eye"></i>0
                                        </div>
                                    </div>
                                    <p class="ratings">
                                        <span>4.0</span> ( 50 Reviews )
                                    </p>
                                    <div class="amount-details">
                                        <div class="amount">
                                            <span class="validrate">${{product.price}}</span>
                                            <span>$450</span>
                                        </div>
                                        <a href="service-details.html">View details</a>
                                    </div>	
                                </div>	
                            </div>			 
                        </div> 
                    </div>
                   
					{% endfor %}							
                </div>	
                <!--Pagination--> 
                <div class="listing-pagination">
					<nav>
						<ul class="pagination">
							<!-- Previous Button -->
							<li class="page-item previtem {% if not page_obj.has_previous %}disabled{% endif %}">
								{% if page_obj.has_previous %}
									<a class="page-link" href="?page={{ page_obj.previous_page_number }}"><i class="fas fa-regular fa-arrow-left"></i> Prev</a>
								{% else %}
									<a class="page-link" href="#" tabindex="-1" aria-disabled="true"><i class="fas fa-regular fa-arrow-left"></i> Prev</a>
								{% endif %}
							</li>
							
							<li class="justify-content-center pagination-center"> 
								<div class="pagelink">
									<ul>
										{% for num in page_obj.paginator.page_range %}
											{% if num == page_obj.number %}
												<li class="page-item active">
													<a class="page-link" href="#">{{ num }}</a>
												</li>
											{% elif num > page_obj.number|add:-2 and num < page_obj.number|add:2 %}
												<li class="page-item">
													<a class="page-link" href="?page={{ num }}">{{ num }}</a>
												</li>
											{% endif %}
										{% endfor %}
									</ul>
								</div>													
							</li>
							
							<!-- Next Button -->
							<li class="page-item nextlink {% if not page_obj.has_next %}disabled{% endif %}">
								{% if page_obj.has_next %}
									<a class="page-link" href="?page={{ page_obj.next_page_number }}">Next <i class="fas fa-regular fa-arrow-right"></i></a>
								{% else %}
									<a class="page-link" href="#" tabindex="-1" aria-disabled="true">Next <i class="fas fa-regular fa-arrow-right"></i></a>
								{% endif %}
							</li>
						</ul>
					</nav>
				</div>
				
				
                <!--/Pagination-->					
            </div>
        </div>
    </div>			  
</div>

		<!-- /Main Content Section -->
				
        <!-- Footer -->
		{% include 'includes/footer.html' %}
		<!-- /Footer -->
		
	</div>

    <!-- scrollToTop start -->
	<div class="progress-wrap active-progress">
		<svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
		<path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" style="transition: stroke-dashoffset 10ms linear 0s; stroke-dasharray: 307.919px, 307.919px; stroke-dashoffset: 228.265px;"></path>
		</svg>
	</div>



	<!-- scrollToTop end -->
   <script>
    function handleSortChange(selectElement) {
        const productContainer = document.getElementById("productContainer");
        let products = Array.from(productContainer.getElementsByClassName("card"));
        let selectedValue = selectElement.value;
    
    
        products.sort((a, b) => {
            let priceA = parseFloat(a.querySelector("h6 a").textContent.replace("$", ""));
            let priceB = parseFloat(b.querySelector("h6 a").textContent.replace("$", ""));
    
    
            if (selectedValue === "low-high") {
                return priceA - priceB;  
            } else if (selectedValue === "high-low") {
                return priceB - priceA; 
            } else {
                return a.dataset.index - b.dataset.index; 
            }
        });
    
        products.forEach(product => {
            productContainer.appendChild(product);
        });
    }
    
   </script>


   
<script>


    document.addEventListener("DOMContentLoaded", function() {
     
    
        const filterForm = document.getElementById("filterForm");
        if (!filterForm) {
         
            return;
        }
    
        filterForm.addEventListener("submit", function(event) {
            event.preventDefault();
    
            const formData = new FormData(filterForm);
            for (const pair of formData.entries()) {
                console.log(pair[0] + ': ' + pair[1]);
            }
    
            const searchParams = new URLSearchParams(formData);
            console.log(searchParams.toString(), 'URL parameters');
    
            const url = `/category/search/?${searchParams.toString()}`;
            console.log(url, 'constructed URL');
    
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log("Received Data:", data);
                    updateProductList(data);
                })
                .catch(error => console.error("Error:", error));
        });
    
        function updateProductList(products) {
            const productContainer = document.getElementById('productContainer');
            productContainer.innerHTML = ''; 
    
            products.forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = 'card';
                productElement.innerHTML = `
                    <div class="blog-widget">
                        <div class="blog-img">
                            <a href="service-details.html">
                                <img src="/media/${product.cover_image}" class="img-fluid" alt="blog-img">
                            </a>
                            <div class="fav-item">
                                <span class="featured-text">Featured</span>
                                <a href="javascript:void(0)" class="fav-icon">
                                    <i class="feather-heart"></i>
                                </a>										
                            </div>															    
                        </div>
                        <div class="bloglist-content">
                            <div class="card-body">
                                <h6><a href="service-details.html">${product.product_name}</a></h6>																	 
                                <div class="blog-location-details">
                                    <div class="location-info">
                                       <i class="feather-map-pin"></i> Los Angeles
                                    </div>
                                    <div class="location-info">
                                       <i class="feather-phone-call"></i> +44 6633 6526
                                    </div>
                                    <div class="location-info">
                                       <i class="feather-eye"></i>0
                                    </div>
                                </div>
                                <p class="ratings">
                                    <span>4.0</span> ( 50 Reviews )
                                </p>
                                <div class="amount-details">
                                    <div class="amount">
                                        <span class="validrate">$${product.price}</span>
                                        <span>$450</span>
                                    </div>
                                    <a href="service-details.html">View details</a>
                                </div>	
                            </div>	
                        </div>			 
                    </div>`;
                productContainer.appendChild(productElement);
            });
        }
    });
    
</script>
	
	{% endblock %}